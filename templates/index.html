<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Network Security Monitor Dashboard</title>

    <!-- Modern UI Libraries -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"
      rel="stylesheet"
    />
    <link
      href="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.css"
      rel="stylesheet"
    />

    <!-- Latest Chart.js with plugins -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns@3.0.0/dist/chartjs-adapter-date-fns.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-gradient@0.6.1/dist/chartjs-plugin-gradient.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chartjs-plugin-annotation@3.0.1/dist/chartjs-plugin-annotation.min.js"></script>

    <!-- Additional Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/aos@2.3.4/dist/aos.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
    <!-- D3.js for advanced network visualization -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <!-- Additional UI libraries -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.js"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/notyf@3/notyf.min.css">

   <style>
    
   
   :root {
  /* Network Security Color Palette - Dark Cyber Theme */
  --primary-bg: #0a0f1c;
  --secondary-bg: #1a2332;
  --tertiary-bg: #243447;
  --accent-bg: #2d4263;
  
  /* Cyber Security Accent Colors */
  --cyber-green: #00ff41;
  --cyber-blue: #00d4ff;
  --cyber-purple: #8b5cf6;
  --warning-amber: #fbbf24;
  --danger-red: #ef4444;
  --success-emerald: #10b981;
  
  /* Gradients for depth and modern look */
  --primary-gradient: linear-gradient(135deg, #0a0f1c 0%, #1a2332 50%, #243447 100%);
  --secondary-gradient: linear-gradient(135deg, #1a2332 0%, #243447 100%);
  --cyber-gradient: linear-gradient(135deg, #00ff41 0%, #00d4ff 100%);
  --warning-gradient: linear-gradient(135deg, #fbbf24 0%, #f59e0b 100%);
  --danger-gradient: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
  --success-gradient: linear-gradient(135deg, #10b981 0%, #059669 100%);
  --purple-gradient: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
  
  /* Glass Effects with better visibility */
  --glass-bg: rgba(26, 35, 50, 0.8);
  --glass-bg-secondary: rgba(36, 52, 71, 0.6);
  --glass-border: rgba(0, 255, 65, 0.2);
  --glass-hover: rgba(36, 52, 71, 0.9);
  
  /* Text Colors for maximum readability */
  --text-primary: #ffffff;
  --text-secondary: #cbd5e1;
  --text-muted: #94a3b8;
  --text-accent: #00ff41;
  --text-warning: #fbbf24;
  --text-danger: #ef4444;
  --text-success: #10b981;
  
  /* Shadows with cyber glow effects */
  --shadow-sm: 0 4px 15px rgba(0, 0, 0, 0.3);
  --shadow-md: 0 8px 25px rgba(0, 0, 0, 0.4);
  --shadow-lg: 0 15px 40px rgba(0, 0, 0, 0.5);
  --shadow-xl: 0 20px 50px rgba(0, 0, 0, 0.6);
  --shadow-cyber: 0 0 20px rgba(0, 255, 65, 0.3);
  --shadow-danger: 0 0 20px rgba(239, 68, 68, 0.3);
  --shadow-warning: 0 0 20px rgba(251, 191, 36, 0.3);
  
  /* Border Radius */
  --border-radius: 12px;
  --border-radius-sm: 8px;
  --border-radius-lg: 16px;
}

* {
  margin: 0;
  padding: 0;
  box-sizing: border-box;
}

body {
  font-family: "Inter", "Segoe UI", -apple-system, BlinkMacSystemFont, sans-serif;
  background: var(--primary-gradient);
  color: var(--text-primary);
  min-height: 100vh;
  overflow-x: hidden;
  position: relative;
}

/* Enhanced Background with Security Theme */
body::before {
  content: '';
  position: fixed;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  background: 
    radial-gradient(circle at 20% 80%, rgba(0, 255, 65, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 80% 20%, rgba(0, 212, 255, 0.1) 0%, transparent 50%),
    radial-gradient(circle at 40% 40%, rgba(139, 92, 246, 0.08) 0%, transparent 50%);
  z-index: -1;
  pointer-events: none;
}

/* Matrix-like particles background */
#particles-js {
  position: fixed;
  width: 100%;
  height: 100%;
  top: 0;
  left: 0;
  z-index: -1;
  opacity: 0.3;
}

.dashboard {
  display: grid;
  grid-template-columns: 280px 1fr;
  min-height: 100vh;
}

.sidebar {
  background: var(--glass-bg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  padding: 30px 25px;
  border-right: 2px solid var(--glass-border);
  box-shadow: var(--shadow-lg);
  position: relative;
}

.sidebar::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(180deg, rgba(0, 255, 65, 0.05) 0%, rgba(0, 212, 255, 0.02) 100%);
  pointer-events: none;
  border-radius: inherit;
}

.logo {
  font-size: 1.8rem;
  font-weight: 900;
  margin-bottom: 45px;
  text-align: center;
  background: var(--cyber-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  text-shadow: 0 0 30px rgba(0, 255, 65, 0.5);
  letter-spacing: -0.5px;
  position: relative;
}

.logo::after {
  content: 'SECURITY MONITOR';
  position: absolute;
  bottom: -20px;
  left: 50%;
  transform: translateX(-50%);
  font-size: 0.6rem;
  font-weight: 600;
  color: var(--text-muted);
  letter-spacing: 2px;
}

.nav-item {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 18px 20px;
  margin-bottom: 8px;
  background: var(--glass-bg-secondary);
  border: 1px solid rgba(0, 255, 65, 0.1);
  border-radius: var(--border-radius);
  color: var(--text-primary);
  text-decoration: none;
  transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  cursor: pointer;
  width: 100%;
  font-weight: 600;
  font-size: 0.95rem;
  position: relative;
  overflow: hidden;
}

.nav-item::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 100%;
  background: var(--cyber-gradient);
  transition: left 0.3s ease;
  z-index: -1;
  opacity: 0.1;
}

.nav-item:hover::before {
  left: 0;
}

.nav-item:hover {
  transform: translateX(8px) scale(1.02);
  box-shadow: var(--shadow-cyber);
  border-color: var(--cyber-green);
  background: var(--glass-hover);
  color: var(--text-primary);
}

.nav-item.active {
  background: rgba(0, 255, 65, 0.15);
  box-shadow: var(--shadow-cyber);
  transform: translateX(6px);
  border-color: var(--cyber-green);
  color: var(--text-primary);
}

.nav-item.active::before {
  left: 0;
  opacity: 0.2;
}

.nav-item i {
  font-size: 1.2rem;
  width: 24px;
  text-align: center;
  color: var(--cyber-green);
}

.main-content {
  padding: 35px;
  overflow-y: auto;
  position: relative;
  background: var(--primary-bg);
}

.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 45px;
  padding: 30px 35px;
  background: var(--glass-bg);
  border: 2px solid var(--glass-border);
  border-radius: var(--border-radius-lg);
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
  box-shadow: var(--shadow-lg);
  position: relative;
  overflow: hidden;
}

.header::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(135deg, rgba(0, 255, 65, 0.05) 0%, rgba(0, 212, 255, 0.03) 100%);
  pointer-events: none;
}

.header h1 {
  color: var(--text-primary);
  font-size: 1.8rem;
  font-weight: 700;
}

/* Status indicators with better visibility */
.status-indicator {
  display: flex;
  align-items: center;
  gap: 15px;
  padding: 15px 25px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: 50px;
  backdrop-filter: blur(15px);
  color: var(--text-primary);
}

.status-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  position: relative;
  animation: statusPulse 2s infinite;
}

.status-dot::after {
  content: '';
  position: absolute;
  top: -3px;
  left: -3px;
  right: -3px;
  bottom: -3px;
  border-radius: 50%;
  animation: statusRipple 2s infinite;
}

.status-online {
  background: var(--success-emerald);
  box-shadow: 0 0 15px rgba(16, 185, 129, 0.6);
}

.status-online::after {
  border: 2px solid rgba(16, 185, 129, 0.4);
}

.status-warning {
  background: var(--warning-amber);
  box-shadow: 0 0 15px rgba(251, 191, 36, 0.6);
}

.status-warning::after {
  border: 2px solid rgba(251, 191, 36, 0.4);
}

.status-critical {
  background: var(--danger-red);
  box-shadow: 0 0 15px rgba(239, 68, 68, 0.6);
}

.status-critical::after {
  border: 2px solid rgba(239, 68, 68, 0.4);
}

@keyframes statusPulse {
  0%, 100% { transform: scale(1); opacity: 1; }
  50% { transform: scale(1.1); opacity: 0.8; }
}

@keyframes statusRipple {
  0% { transform: scale(1); opacity: 1; }
  100% { transform: scale(2.5); opacity: 0; }
}

.stats-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 25px;
  margin-bottom: 40px;
}

.stat-card {
  background: var(--glass-bg);
  border: 2px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 30px;
  backdrop-filter: blur(20px);
  transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
  position: relative;
  overflow: hidden;
  box-shadow: var(--shadow-md);
}

.stat-card::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 4px;
  background: var(--cyber-gradient);
  transform: scaleX(0);
  transition: transform 0.4s ease;
}

.stat-card:hover::before {
  transform: scaleX(1);
}

.stat-card:hover {
  transform: translateY(-8px) scale(1.02);
  box-shadow: var(--shadow-cyber);
  border-color: var(--cyber-green);
}

.stat-card h3 {
  font-size: 1rem;
  font-weight: 600;
  color: var(--text-secondary);
  margin-bottom: 15px;
  display: flex;
  align-items: center;
  gap: 10px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.stat-card h3 i {
  font-size: 1.2rem;
  color: var(--cyber-green);
}

.stat-value {
  font-size: 2.8rem;
  font-weight: 800;
  margin-bottom: 15px;
  background: var(--cyber-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  line-height: 1;
}

.stat-change {
  font-size: 0.9rem;
  color: var(--text-muted);
  display: flex;
  align-items: center;
  gap: 5px;
  font-weight: 500;
}

.stat-change.positive {
  color: var(--success-emerald);
}

.stat-change.negative {
  color: var(--danger-red);
}

.alerts-container {
  background: var(--glass-bg);
  border-radius: var(--border-radius-lg);
  padding: 25px;
  margin-bottom: 30px;
  backdrop-filter: blur(20px);
  border: 2px solid var(--glass-border);
  box-shadow: var(--shadow-md);
}

.alerts-container h3 {
  color: var(--text-primary);
  margin-bottom: 20px;
  font-size: 1.3rem;
  font-weight: 700;
}

.alert-item {
  display: flex;
  align-items: center;
  padding: 15px;
  margin-bottom: 10px;
  border-radius: var(--border-radius);
  border-left: 4px solid;
  animation: slideIn 0.5s ease;
  backdrop-filter: blur(10px);
  color: var(--text-primary);
}

.alert-critical {
  background: rgba(239, 68, 68, 0.15);
  border-left-color: var(--danger-red);
  box-shadow: var(--shadow-danger);
}

.alert-high {
  background: rgba(251, 191, 36, 0.15);
  border-left-color: var(--warning-amber);
  box-shadow: var(--shadow-warning);
}

.alert-medium {
  background: rgba(139, 92, 246, 0.15);
  border-left-color: var(--cyber-purple);
}

.alert-low {
  background: rgba(16, 185, 129, 0.15);
  border-left-color: var(--success-emerald);
}

@keyframes slideIn {
  from {
    opacity: 0;
    transform: translateX(-20px);
  }
  to {
    opacity: 1;
    transform: translateX(0);
  }
}

.alert-severity {
  padding: 6px 12px;
  border-radius: 20px;
  font-size: 0.75rem;
  font-weight: 700;
  margin-right: 15px;
  min-width: 80px;
  text-align: center;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.severity-critical {
  background: var(--danger-red);
  color: white;
}

.severity-high {
  background: var(--warning-amber);
  color: var(--primary-bg);
}

.severity-medium {
  background: var(--cyber-purple);
  color: white;
}

.severity-low {
  background: var(--success-emerald);
  color: white;
}

.alert-content {
  flex: 1;
  color: var(--text-primary);
}

.alert-content h4 {
  font-weight: 600;
  margin-bottom: 4px;
}

.alert-time {
  font-size: 0.8rem;
  color: var(--text-muted);
  font-weight: 500;
}

.chart-container {
  background: var(--glass-bg);
  border: 2px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 30px;
  margin-bottom: 40px;
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-md);
  position: relative;
  overflow: hidden;
  transition: all 0.4s ease;
}

.chart-container::before {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  height: 3px;
  background: var(--cyber-gradient);
}

.chart-container:hover {
  transform: translateY(-5px);
  box-shadow: var(--shadow-cyber);
  border-color: var(--cyber-green);
}

.chart-container h3 {
  font-size: 1.3rem;
  font-weight: 700;
  margin-bottom: 25px;
  color: var(--text-primary);
  display: flex;
  align-items: center;
  gap: 12px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.chart-container h3 i {
  color: var(--cyber-green);
}

.chart-wrapper {
  position: relative;
  height: 350px;
  background: rgba(10, 15, 28, 0.6);
  border-radius: var(--border-radius);
  padding: 20px;
  border: 1px solid rgba(0, 255, 65, 0.1);
}

/* Network Map Styles */
.network-map-container {
  background: var(--glass-bg);
  border-radius: var(--border-radius-lg);
  padding: 20px;
  backdrop-filter: blur(20px);
  border: 2px solid var(--glass-border);
  box-shadow: var(--shadow-md);
}

.network-map {
  height: 400px;
  background: rgba(10, 15, 28, 0.8);
  border-radius: var(--border-radius);
  position: relative;
  overflow: hidden;
  margin-bottom: 20px;
  border: 1px solid var(--glass-border);
}

.map-legend {
  display: flex;
  gap: 20px;
  justify-content: center;
  flex-wrap: wrap;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.9rem;
  color: var(--text-primary);
  font-weight: 500;
}

.legend-dot {
  width: 12px;
  height: 12px;
  border-radius: 50%;
  box-shadow: 0 0 8px currentColor;
}

.legend-dot.internal {
  background: var(--success-emerald);
}

.legend-dot.external {
  background: var(--danger-red);
}

.legend-dot.gateway {
  background: var(--cyber-blue);
}

/* Analytics Grid */
.analytics-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 25px;
  margin-bottom: 30px;
}

/* Risk Meter */
.risk-meter {
  text-align: center;
  padding: 25px;
  background: var(--glass-bg);
  border-radius: var(--border-radius);
  border: 2px solid var(--glass-border);
  backdrop-filter: blur(20px);
}

.risk-score {
  display: flex;
  flex-direction: column;
  align-items: center;
  margin-bottom: 20px;
}

.risk-score span:first-child {
  font-size: 3.5rem;
  font-weight: 900;
  background: var(--cyber-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
}

.risk-label {
  font-size: 0.9rem;
  color: var(--text-muted);
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.risk-level {
  font-size: 1.2rem;
  font-weight: 700;
  margin-bottom: 15px;
  padding: 10px 20px;
  border-radius: 25px;
  display: inline-block;
  text-transform: uppercase;
  letter-spacing: 1px;
}

.risk-level.LOW {
  background: rgba(16, 185, 129, 0.2);
  color: var(--success-emerald);
  border: 1px solid var(--success-emerald);
}

.risk-level.MEDIUM {
  background: rgba(251, 191, 36, 0.2);
  color: var(--warning-amber);
  border: 1px solid var(--warning-amber);
}

.risk-level.HIGH {
  background: rgba(239, 68, 68, 0.2);
  color: var(--danger-red);
  border: 1px solid var(--danger-red);
}

.risk-bar {
  width: 100%;
  height: 20px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 10px;
  overflow: hidden;
  margin-bottom: 20px;
  border: 1px solid var(--glass-border);
}

.risk-fill {
  height: 100%;
  background: linear-gradient(90deg, var(--success-emerald), var(--warning-amber), var(--danger-red));
  transition: width 0.5s ease;
  border-radius: 10px;
}

.risk-factors {
  text-align: left;
}

.risk-factor {
  background: rgba(36, 52, 71, 0.6);
  padding: 12px;
  margin-bottom: 8px;
  border-radius: var(--border-radius-sm);
  border-left: 3px solid var(--cyber-green);
  color: var(--text-primary);
  font-weight: 500;
}

.packets-table {
  background: var(--glass-bg);
  border-radius: var(--border-radius-lg);
  padding: 25px;
  backdrop-filter: blur(20px);
  overflow-x: auto;
  border: 2px solid var(--glass-border);
  box-shadow: var(--shadow-md);
}

.packets-table h3 {
  color: var(--text-primary);
  margin-bottom: 20px;
  font-size: 1.3rem;
  font-weight: 700;
}

.packets-table table {
  width: 100%;
  border-collapse: collapse;
}

.packets-table th,
.packets-table td {
  padding: 15px 12px;
  text-align: left;
  border-bottom: 1px solid rgba(0, 255, 65, 0.1);
  color: var(--text-primary);
}

.packets-table th {
  background: var(--glass-bg-secondary);
  font-weight: 700;
  color: var(--text-primary);
  font-size: 0.9rem;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-bottom: 2px solid var(--cyber-green);
}

.packets-table tr:hover {
  background: var(--glass-hover);
  color: var(--text-primary);
}

.btn {
  padding: 12px 24px;
  border: none;
  border-radius: var(--border-radius-sm);
  cursor: pointer;
  font-weight: 600;
  transition: all 0.3s ease;
  text-decoration: none;
  display: inline-block;
  margin: 5px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 0.9rem;
}

.btn-primary {
  background: var(--cyber-gradient);
  color: var(--primary-bg);
  box-shadow: var(--shadow-cyber);
}

.btn-danger {
  background: var(--danger-gradient);
  color: white;
  box-shadow: var(--shadow-danger);
}

.btn-warning {
  background: var(--warning-gradient);
  color: var(--primary-bg);
  box-shadow: var(--shadow-warning);
}

.btn:hover {
  transform: translateY(-3px) scale(1.05);
  box-shadow: 0 8px 25px rgba(0, 0, 0, 0.4);
}

.modal {
  display: none;
  position: fixed;
  z-index: 1000;
  left: 0;
  top: 0;
  width: 100%;
  height: 100%;
  background: rgba(10, 15, 28, 0.9);
  backdrop-filter: blur(10px);
}

.modal-content {
  background: var(--glass-bg);
  margin: 10% auto;
  padding: 35px;
  border-radius: var(--border-radius-lg);
  width: 80%;
  max-width: 500px;
  border: 2px solid var(--glass-border);
  backdrop-filter: blur(20px);
  box-shadow: var(--shadow-xl);
}

.close {
  color: var(--text-muted);
  float: right;
  font-size: 28px;
  font-weight: bold;
  cursor: pointer;
  transition: color 0.3s ease;
}

.close:hover {
  color: var(--text-primary);
}

.form-group {
  margin-bottom: 25px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--text-primary);
  text-transform: uppercase;
  letter-spacing: 0.5px;
  font-size: 0.9rem;
}

.form-group input {
  width: 100%;
  padding: 15px;
  border: 2px solid var(--glass-border);
  border-radius: var(--border-radius-sm);
  background: var(--glass-bg-secondary);
  color: var(--text-primary);
  font-size: 14px;
  font-weight: 500;
  transition: all 0.3s ease;
}

.form-group input:focus {
  outline: none;
  border-color: var(--cyber-green);
  box-shadow: var(--shadow-cyber);
}

.form-group input::placeholder {
  color: var(--text-muted);
}

.hidden {
  display: none;
}

.loading {
  text-align: center;
  color: var(--text-secondary);
  margin: 20px 0;
}

.spinner {
  border: 3px solid var(--glass-border);
  border-radius: 50%;
  border-top: 3px solid var(--cyber-green);
  width: 40px;
  height: 40px;
  animation: spin 1s linear infinite;
  margin: 0 auto;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Utility classes */
.text-success { color: var(--success-emerald) !important; }
.text-warning { color: var(--warning-amber) !important; }
.text-danger { color: var(--danger-red) !important; }
.text-primary { color: var(--text-primary) !important; }
.text-secondary { color: var(--text-secondary) !important; }
.text-muted { color: var(--text-muted) !important; }

.bg-success { background: var(--success-gradient) !important; }
.bg-warning { background: var(--warning-gradient) !important; }
.bg-danger { background: var(--danger-gradient) !important; }

/* Mobile Responsive */
@media (max-width: 768px) {
  .dashboard {
    grid-template-columns: 1fr;
  }

  .sidebar {
    display: none;
  }

  .main-content {
    padding: 20px;
  }

  .header {
    padding: 20px;
    margin-bottom: 30px;
  }

  .stats-grid {
    grid-template-columns: 1fr;
    gap: 20px;
  }

  .analytics-grid {
    grid-template-columns: 1fr;
  }

  .stat-card {
    padding: 20px;
  }

  .chart-container {
    padding: 20px;
  }

  .chart-wrapper {
    height: 250px;
  }
}

/* Scrollbar Styling */
::-webkit-scrollbar {
  width: 8px;
}

::-webkit-scrollbar-track {
  background: var(--primary-bg);
}

::-webkit-scrollbar-thumb {
  background: var(--cyber-green);
  border-radius: 4px;
}

::-webkit-scrollbar-thumb:hover {
  background: var(--cyber-blue);
}

/* Additional cyber security themed elements */
.cyber-grid {
  background-image: 
    linear-gradient(rgba(0, 255, 65, 0.1) 1px, transparent 1px),
    linear-gradient(90deg, rgba(0, 255, 65, 0.1) 1px, transparent 1px);
  background-size: 20px 20px;
}

.pulse-border {
  animation: pulseBorder 2s infinite;
}

@keyframes pulseBorder {
  0%, 100% {
    border-color: var(--glass-border);
  }
  50% {
    border-color: var(--cyber-green);
  }
}

/* Network activity indicators */
.network-activity {
  position: relative;
  overflow: hidden;
}

.network-activity::before {
  content: '';
  position: absolute;
  top: 0;
  left: -100%;
  width: 100%;
  height: 2px;
  background: linear-gradient(90deg, transparent, var(--cyber-green), transparent);
  animation: networkScan 3s infinite;
}

@keyframes networkScan {
  0% {
    left: -100%;
  }
  100% {
    left: 100%;
  }
}

/* Threat level indicators */
.threat-level-high {
  border-left: 4px solid var(--danger-red);
  background: rgba(239, 68, 68, 0.1);
  animation: threatPulse 1.5s infinite;
}

.threat-level-medium {
  border-left: 4px solid var(--warning-amber);
  background: rgba(251, 191, 36, 0.1);
}

.threat-level-low {
  border-left: 4px solid var(--success-emerald);
  background: rgba(16, 185, 129, 0.1);
}

@keyframes threatPulse {
  0%, 100% {
    box-shadow: 0 0 5px rgba(239, 68, 68, 0.3);
  }
  50% {
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.6);
  }
}

/* Data flow animation */
.data-flow {
  position: relative;
  overflow: hidden;
}

.data-flow::after {
  content: '';
  position: absolute;
  top: 50%;
  left: 0;
  width: 100%;
  height: 1px;
  background: linear-gradient(90deg, 
    transparent 0%, 
    var(--cyber-green) 20%, 
    var(--cyber-blue) 50%, 
    var(--cyber-green) 80%, 
    transparent 100%);
  animation: dataFlow 2s infinite;
}

@keyframes dataFlow {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

/* System status cards */
.system-status {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
  gap: 20px;
  margin-bottom: 30px;
}

.system-card {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 20px;
  backdrop-filter: blur(15px);
  transition: all 0.3s ease;
  position: relative;
}

.system-card:hover {
  border-color: var(--cyber-green);
  box-shadow: var(--shadow-cyber);
}

.system-card .status-icon {
  font-size: 2rem;
  margin-bottom: 10px;
  display: block;
}

.system-card .status-icon.online {
  color: var(--success-emerald);
  animation: pulse 2s infinite;
}

.system-card .status-icon.warning {
  color: var(--warning-amber);
  animation: pulse 2s infinite;
}

.system-card .status-icon.offline {
  color: var(--danger-red);
  animation: pulse 2s infinite;
}

@keyframes pulse {
  0%, 100% {
    opacity: 1;
  }
  50% {
    opacity: 0.6;
  }
}

.system-card h4 {
  color: var(--text-primary);
  font-size: 1.1rem;
  font-weight: 600;
  margin-bottom: 5px;
}

.system-card p {
  color: var(--text-secondary);
  font-size: 0.9rem;
  margin-bottom: 10px;
}

.system-card .last-update {
  color: var(--text-muted);
  font-size: 0.8rem;
  font-style: italic;
}

/* Connection status */
.connection-status {
  display: flex;
  align-items: center;
  gap: 10px;
  padding: 10px 15px;
  background: var(--glass-bg-secondary);
  border-radius: 25px;
  font-size: 0.9rem;
  font-weight: 500;
}

.connection-status.secure {
  color: var(--success-emerald);
  border: 1px solid rgba(16, 185, 129, 0.3);
}

.connection-status.insecure {
  color: var(--danger-red);
  border: 1px solid rgba(239, 68, 68, 0.3);
}

.connection-status.unknown {
  color: var(--warning-amber);
  border: 1px solid rgba(251, 191, 36, 0.3);
}

/* Progress bars */
.progress-bar {
  width: 100%;
  height: 8px;
  background: rgba(255, 255, 255, 0.1);
  border-radius: 4px;
  overflow: hidden;
  margin: 10px 0;
}

.progress-fill {
  height: 100%;
  background: var(--cyber-gradient);
  border-radius: 4px;
  transition: width 0.5s ease;
  position: relative;
}

.progress-fill::after {
  content: '';
  position: absolute;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: linear-gradient(90deg, 
    transparent 0%, 
    rgba(255, 255, 255, 0.3) 50%, 
    transparent 100%);
  animation: progressShimmer 2s infinite;
}

@keyframes progressShimmer {
  0% {
    transform: translateX(-100%);
  }
  100% {
    transform: translateX(100%);
  }
}

/* Badge styles */
.badge {
  display: inline-block;
  padding: 4px 8px;
  font-size: 0.75rem;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.5px;
  border-radius: 12px;
  border: 1px solid;
}

.badge-success {
  color: var(--success-emerald);
  background: rgba(16, 185, 129, 0.1);
  border-color: var(--success-emerald);
}

.badge-warning {
  color: var(--warning-amber);
  background: rgba(251, 191, 36, 0.1);
  border-color: var(--warning-amber);
}

.badge-danger {
  color: var(--danger-red);
  background: rgba(239, 68, 68, 0.1);
  border-color: var(--danger-red);
}

.badge-info {
  color: var(--cyber-blue);
  background: rgba(0, 212, 255, 0.1);
  border-color: var(--cyber-blue);
}

/* Tooltip styles */
.tooltip {
  position: relative;
  cursor: help;
}

.tooltip:hover::after {
  content: attr(data-tooltip);
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%);
  background: var(--glass-bg);
  color: var(--text-primary);
  padding: 8px 12px;
  border-radius: var(--border-radius-sm);
  font-size: 0.8rem;
  white-space: nowrap;
  border: 1px solid var(--glass-border);
  backdrop-filter: blur(10px);
  z-index: 1000;
  box-shadow: var(--shadow-md);
}

.tooltip:hover::before {
  content: '';
  position: absolute;
  bottom: 100%;
  left: 50%;
  transform: translateX(-50%) translateY(1px);
  border: 5px solid transparent;
  border-top-color: var(--glass-border);
  z-index: 1001;
}

/* Terminal/console styles */
.console {
  background: rgba(10, 15, 28, 0.9);
  border: 1px solid var(--cyber-green);
  border-radius: var(--border-radius);
  padding: 20px;
  font-family: 'Courier New', monospace;
  color: var(--cyber-green);
  font-size: 0.9rem;
  line-height: 1.4;
  max-height: 300px;
  overflow-y: auto;
}

.console-line {
  margin-bottom: 5px;
}

.console-line::before {
  content: '> ';
  color: var(--cyber-blue);
  font-weight: bold;
}

.console-error {
  color: var(--danger-red);
}

.console-warning {
  color: var(--warning-amber);
}

.console-success {
  color: var(--success-emerald);
}

/* Typography enhancements */
h1, h2, h3, h4, h5, h6 {
  color: var(--text-primary);
  font-weight: 700;
}

.cyber-text {
  background: var(--cyber-gradient);
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text;
  font-weight: 700;
}

.highlight-text {
  color: var(--cyber-green);
  font-weight: 600;
}

.muted-text {
  color: var(--text-muted);
}

/* Final touch - ensure all text elements have proper contrast */
* {
  color: inherit;
}

input, textarea, select {
  color: var(--text-primary);
}

a {
  color: var(--cyber-blue);
  text-decoration: none;
  transition: color 0.3s ease;
}

a:hover {
  color: var(--cyber-green);
}

/* Enhanced Network Map Styles */
.network-filters {
  background: var(--glass-bg-secondary);
  padding: 20px;
  border-radius: var(--border-radius);
  margin-bottom: 20px;
  border: 1px solid var(--glass-border);
}

.filter-group {
  display: flex;
  gap: 15px;
  align-items: center;
  flex-wrap: wrap;
}

.filter-group .form-control {
  min-width: 150px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  color: var(--text-primary);
  padding: 8px 12px;
  border-radius: var(--border-radius-sm);
}

.enhanced-map {
  position: relative;
  min-height: 500px;
  background: radial-gradient(circle at center, rgba(0, 255, 65, 0.05) 0%, transparent 70%);
}

.network-stats-panel {
  position: absolute;
  top: 20px;
  right: 20px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 15px;
  min-width: 200px;
  backdrop-filter: blur(10px);
}

.stat-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 8px;
  font-size: 0.9rem;
}

.stat-label {
  color: var(--text-secondary);
}

.stat-value {
  color: var(--text-primary);
  font-weight: 600;
}

.enhanced-legend {
  position: absolute;
  bottom: 20px;
  left: 20px;
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 15px;
  backdrop-filter: blur(10px);
  display: flex;
  gap: 30px;
}

.legend-section h4 {
  color: var(--text-primary);
  font-size: 0.9rem;
  margin-bottom: 10px;
  font-weight: 600;
}

.legend-items {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.legend-item {
  display: flex;
  align-items: center;
  gap: 8px;
  font-size: 0.8rem;
  color: var(--text-secondary);
}

.legend-dot.server {
  background: var(--cyber-purple);
}

.legend-dot.workstation {
  background: var(--warning-amber);
}

.connection-line {
  width: 20px;
  height: 2px;
  display: inline-block;
}

.connection-line.normal {
  background: rgba(255, 255, 255, 0.5);
}

.connection-line.suspicious {
  background: var(--warning-amber);
  box-shadow: 0 0 5px var(--warning-amber);
}

.connection-line.blocked {
  background: var(--danger-red);
  box-shadow: 0 0 5px var(--danger-red);
}

.device-details-panel {
  background: var(--glass-bg-secondary);
  border-radius: var(--border-radius);
  padding: 20px;
  min-height: 200px;
}

.device-info {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
  gap: 15px;
  margin-bottom: 20px;
}

.info-item {
  background: var(--glass-bg);
  padding: 10px;
  border-radius: var(--border-radius-sm);
  border: 1px solid var(--glass-border);
}

.info-label {
  color: var(--text-muted);
  font-size: 0.8rem;
  margin-bottom: 5px;
}

.info-value {
  color: var(--text-primary);
  font-weight: 600;
}

.security-zones {
  display: flex;
  flex-direction: column;
  gap: 15px;
}

.zone-item {
  background: var(--glass-bg-secondary);
  border-radius: var(--border-radius);
  padding: 15px;
  border-left: 4px solid;
}

.zone-trusted {
  border-left-color: var(--success-emerald);
}

.zone-dmz {
  border-left-color: var(--warning-amber);
}

.zone-external {
  border-left-color: var(--danger-red);
}

.zone-header {
  display: flex;
  align-items: center;
  gap: 10px;
  margin-bottom: 10px;
  color: var(--text-primary);
  font-weight: 600;
}

.zone-stats {
  display: flex;
  gap: 20px;
  font-size: 0.9rem;
  color: var(--text-secondary);
}

/* Enhanced Settings Styles */
.settings-nav {
  display: flex;
  background: var(--glass-bg);
  border-radius: var(--border-radius-lg);
  padding: 5px;
  margin-bottom: 30px;
  border: 1px solid var(--glass-border);
  overflow-x: auto;
}

.settings-tab {
  flex: 1;
  padding: 12px 20px;
  background: transparent;
  border: none;
  color: var(--text-secondary);
  font-weight: 600;
  border-radius: var(--border-radius);
  cursor: pointer;
  transition: all 0.3s ease;
  white-space: nowrap;
  min-width: 120px;
}

.settings-tab:hover {
  background: var(--glass-bg-secondary);
  color: var(--text-primary);
}

.settings-tab.active {
  background: var(--cyber-gradient);
  color: var(--primary-bg);
  box-shadow: var(--shadow-cyber);
}

.settings-tab-content {
  display: none;
}

.settings-tab-content.active {
  display: block;
}

.settings-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
  gap: 25px;
  margin-bottom: 30px;
}

.settings-card {
  background: var(--glass-bg);
  border: 1px solid var(--glass-border);
  border-radius: var(--border-radius);
  padding: 25px;
  backdrop-filter: blur(15px);
  transition: all 0.3s ease;
}

.settings-card:hover {
  border-color: var(--cyber-green);
  box-shadow: var(--shadow-cyber);
}

.settings-card h4 {
  color: var(--text-primary);
  margin-bottom: 20px;
  font-size: 1.1rem;
  font-weight: 700;
  display: flex;
  align-items: center;
  gap: 10px;
}

.settings-card h4::before {
  content: '';
  width: 4px;
  height: 20px;
  background: var(--cyber-gradient);
  border-radius: 2px;
}

.form-group {
  margin-bottom: 20px;
}

.form-group label {
  display: block;
  margin-bottom: 8px;
  font-weight: 600;
  color: var(--text-primary);
  font-size: 0.9rem;
}

.form-group small {
  display: block;
  margin-top: 5px;
  color: var(--text-muted);
  font-size: 0.8rem;
  font-style: italic;
}

.form-control {
  width: 100%;
  padding: 12px 15px;
  border: 2px solid var(--glass-border);
  border-radius: var(--border-radius-sm);
  background: var(--glass-bg-secondary);
  color: var(--text-primary);
  font-size: 0.9rem;
  transition: all 0.3s ease;
}

.form-control:focus {
  outline: none;
  border-color: var(--cyber-green);
  box-shadow: var(--shadow-cyber);
  background: var(--glass-bg);
}

.form-control::placeholder {
  color: var(--text-muted);
}

/* Custom Checkbox Styles */
.checkbox-label {
  display: flex !important;
  align-items: center;
  gap: 12px;
  cursor: pointer;
  font-weight: 500 !important;
  margin-bottom: 0 !important;
}

.checkbox-label input[type="checkbox"] {
  display: none;
}

.checkmark {
  width: 20px;
  height: 20px;
  background: var(--glass-bg-secondary);
  border: 2px solid var(--glass-border);
  border-radius: 4px;
  position: relative;
  transition: all 0.3s ease;
}

.checkbox-label input[type="checkbox"]:checked + .checkmark {
  background: var(--cyber-gradient);
  border-color: var(--cyber-green);
}

.checkbox-label input[type="checkbox"]:checked + .checkmark::after {
  content: '‚úì';
  position: absolute;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  color: var(--primary-bg);
  font-weight: bold;
  font-size: 12px;
}

/* Rules Management */
.rules-container {
  margin-top: 20px;
}

.rule-item {
  background: var(--glass-bg-secondary);
  border-radius: var(--border-radius);
  padding: 15px;
  margin-bottom: 15px;
  border: 1px solid var(--glass-border);
}

.rule-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 10px;
  color: var(--text-primary);
  font-weight: 600;
}

.rules-list {
  max-height: 200px;
  overflow-y: auto;
}

.rule-entry {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: var(--glass-bg);
  border-radius: var(--border-radius-sm);
  margin-bottom: 5px;
  border: 1px solid var(--glass-border);
}

.rule-text {
  color: var(--text-primary);
  font-family: monospace;
  font-size: 0.9rem;
}

.rule-actions {
  display: flex;
  gap: 5px;
}

.btn-sm {
  padding: 4px 8px;
  font-size: 0.8rem;
  border-radius: 4px;
}

/* Action Buttons */
.action-buttons {
  display: flex;
  gap: 10px;
  flex-wrap: wrap;
}

.settings-actions {
  display: flex;
  justify-content: center;
  gap: 20px;
  margin-top: 30px;
  padding: 20px;
  background: var(--glass-bg);
  border-radius: var(--border-radius);
  border: 1px solid var(--glass-border);
}

.network-controls {
  display: flex;
  gap: 10px;
  align-items: center;
}

/* Button Variants */
.btn-info {
  background: linear-gradient(135deg, var(--cyber-blue) 0%, #0ea5e9 100%);
  color: white;
  border: none;
}

.btn-info:hover {
  background: linear-gradient(135deg, #0ea5e9 0%, var(--cyber-blue) 100%);
}

.btn-success {
  background: var(--success-gradient);
  color: white;
  border: none;
}

.btn-success:hover {
  background: linear-gradient(135deg, #059669 0%, var(--success-emerald) 100%);
}

.btn-secondary {
  background: linear-gradient(135deg, var(--text-muted) 0%, #64748b 100%);
  color: white;
  border: none;
}

.btn-secondary:hover {
  background: linear-gradient(135deg, #64748b 0%, var(--text-muted) 100%);
}

/* Traffic Flow Chart Container */
.traffic-flow-container {
  position: relative;
  height: 300px;
  background: rgba(10, 15, 28, 0.6);
  border-radius: var(--border-radius);
  padding: 20px;
  border: 1px solid var(--glass-border);
}

/* Responsive Design for New Features */
@media (max-width: 768px) {
  .settings-nav {
    flex-direction: column;
  }
  
  .settings-tab {
    min-width: auto;
  }
  
  .settings-grid {
    grid-template-columns: 1fr;
  }
  
  .filter-group {
    flex-direction: column;
    align-items: stretch;
  }
  
  .enhanced-legend {
    position: relative;
    bottom: auto;
    left: auto;
    margin-top: 20px;
    flex-direction: column;
  }
  
  .network-stats-panel {
    position: relative;
    top: auto;
    right: auto;
    margin-bottom: 20px;
  }
  
  .action-buttons {
    flex-direction: column;
  }
  
  .settings-actions {
    flex-direction: column;
  }
}

</style>
  
  </head>
  <body>
    <div id="particles-js"></div>
    <div class="dashboard">
      <div class="sidebar" data-aos="fade-right">
        <div class="logo animate__animated animate__pulse animate__infinite">
          <i class="fas fa-shield-alt"></i> SecureNet
        </div>
        <button
          class="nav-item active"
          onclick="showSection('overview')"
          data-aos="fade-right"
          data-aos-delay="100"
        >
          <i class="fas fa-chart-line"></i> Overview
        </button>
        <button
          class="nav-item"
          onclick="showSection('alerts')"
          data-aos="fade-right"
          data-aos-delay="200"
        >
          <i class="fas fa-exclamation-triangle"></i> Security Alerts
        </button>
        <button
          class="nav-item"
          onclick="showSection('packets')"
          data-aos="fade-right"
          data-aos-delay="300"
        >
          <i class="fas fa-network-wired"></i> Live Packets
        </button>
        <button
          class="nav-item"
          onclick="showSection('network')"
          data-aos="fade-right"
          data-aos-delay="400"
        >
          <i class="fas fa-project-diagram"></i> Network Map
        </button>
        <button
          class="nav-item"
          onclick="showSection('settings')"
          data-aos="fade-right"
          data-aos-delay="500"
        >
          <i class="fas fa-cog"></i> Settings
        </button>
      </div>

      <div class="main-content">
        <div class="header">
          <h1>Network Security Monitor</h1>
          <div class="status-indicator">
            <div class="status-dot status-online" id="statusDot"></div>
            <span id="statusText">Monitoring Active</span>
          </div>
        </div>

        <!-- Overview Section -->
        <div id="overview-section" class="section">
          <div class="stats-grid">
            <div class="stat-card" data-aos="fade-up" data-aos-delay="100">
              <h3><i class="fas fa-stream"></i> Total Packets Captured</h3>
              <div class="stat-value" id="totalPackets">0</div>
              <div class="stat-change positive">
                <i class="fas fa-arrow-up"></i> +12% from last hour
              </div>
            </div>
            <div class="stat-card" data-aos="fade-up" data-aos-delay="200">
              <h3><i class="fas fa-shield-alt"></i> Security Alerts</h3>
              <div class="stat-value" id="totalAlerts">0</div>
              <div class="stat-change negative">
                <i class="fas fa-exclamation-circle"></i> 2 critical, 5 high
                priority
              </div>
            </div>
            <div class="stat-card" data-aos="fade-up" data-aos-delay="300">
              <h3><i class="fas fa-ban"></i> Blocked IPs</h3>
              <div class="stat-value" id="blockedIPs">0</div>
              <div class="stat-change">
                <i class="fas fa-clock"></i> Last block: 2 mins ago
              </div>
            </div>
            <div class="stat-card" data-aos="fade-up" data-aos-delay="400">
              <h3><i class="fas fa-laptop"></i> Network Devices</h3>
              <div class="stat-value" id="networkDevices">0</div>
              <div class="stat-change positive">
                <i class="fas fa-plus"></i> 3 new devices today
              </div>
            </div>
          </div>

          <div class="chart-container" data-aos="fade-up" data-aos-delay="500">
            <h3><i class="fas fa-chart-area"></i> Network Traffic Analysis</h3>
            <div class="chart-wrapper">
              <canvas id="trafficChart"></canvas>
            </div>
          </div>

          <div class="chart-container" data-aos="fade-up" data-aos-delay="600">
            <h3><i class="fas fa-chart-pie"></i> Security Alert Trends</h3>
            <div class="chart-wrapper">
              <canvas id="alertChart"></canvas>
            </div>
          </div>

          <!-- Network Topology Map -->
          <div class="chart-container">
            <h3>üåê Network Topology Map</h3>
            <div class="network-map-container">
              <div id="overviewNetworkMap" class="network-map"></div>
              <div class="map-legend">
                <div class="legend-item">
                  <span class="legend-dot internal"></span>
                  Internal Device
                </div>
                <div class="legend-item">
                  <span class="legend-dot external"></span>
                  External Device
                </div>
                <div class="legend-item">
                  <span class="legend-dot gateway"></span>
                  Gateway
                </div>
              </div>
            </div>
          </div>

          <!-- Additional Analytics Charts -->
          <div class="analytics-grid">
            <div class="chart-container">
              <h3>üìä Protocol Distribution</h3>
              <div class="chart-wrapper">
                <canvas id="protocolChart"></canvas>
              </div>
            </div>
            <div class="chart-container">
              <h3>üîå Top Destination Ports</h3>
              <div class="chart-wrapper">
                <canvas id="portsChart"></canvas>
              </div>
            </div>
          </div>

          <div class="analytics-grid">
            <div class="chart-container">
              <h3>‚è∞ Hourly Traffic Pattern</h3>
              <div class="chart-wrapper">
                <canvas id="hourlyChart"></canvas>
              </div>
            </div>
            <div class="chart-container">
              <h3>‚ö†Ô∏è Risk Assessment</h3>
              <div class="risk-meter">
                <div class="risk-score">
                  <span id="riskScore">0</span>
                  <span class="risk-label">Risk Score</span>
                </div>
                <div class="risk-level" id="riskLevel">LOW</div>
                <div class="risk-bar">
                  <div class="risk-fill" id="riskFill"></div>
                </div>
              </div>
              <div class="risk-factors" id="riskFactors">
                <!-- Risk factors will be populated here -->
              </div>
            </div>
          </div>
        </div>

        <!-- Alerts Section -->
        <div id="alerts-section" class="section hidden">
          <div class="alerts-container">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
              "
            >
              <h3>üö® Real-time Security Alerts</h3>
              <button class="btn btn-primary" onclick="clearAlerts()">
                Clear All
              </button>
            </div>
            <div id="alertsList">
              <div class="loading">
                <div class="spinner"></div>
                <p>Loading alerts...</p>
              </div>
            </div>
          </div>
        </div>

        <!-- Packets Section -->
        <div id="packets-section" class="section hidden">
          <div class="packets-table">
            <div
              style="
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 20px;
              "
            >
              <h3>üì¶ Live Network Packets</h3>
              <div>
                <button class="btn btn-primary" onclick="toggleCapture()">
                  Pause Capture
                </button>
                <button class="btn btn-primary" onclick="exportPackets()">
                  Export
                </button>
              </div>
            </div>
            <table>
              <thead>
                <tr>
                  <th>Timestamp</th>
                  <th>Source IP</th>
                  <th>Destination IP</th>
                  <th>Protocol</th>
                  <th>Source Port</th>
                  <th>Dest Port</th>
                  <th>Layer</th>
                </tr>
              </thead>
              <tbody id="packetsTableBody">
                <tr>
                  <td colspan="7" class="loading">Loading packets...</td>
                </tr>
              </tbody>
            </table>
          </div>
        </div>

        <!-- Enhanced Network Section -->
        <div id="network-section" class="section hidden">
          <!-- Network Controls -->
          <div class="chart-container" data-aos="fade-up">
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
              <h3><i class="fas fa-project-diagram"></i> Advanced Network Topology</h3>
              <div class="network-controls">
                <button class="btn btn-primary" onclick="refreshNetworkMap()"><i class="fas fa-sync-alt"></i> Refresh</button>
                <button class="btn btn-primary" onclick="toggleNetworkLayout()"><i class="fas fa-expand-arrows-alt"></i> Layout</button>
                <button class="btn btn-primary" onclick="exportNetworkMap()"><i class="fas fa-download"></i> Export</button>
              </div>
            </div>
            
            <!-- Network Search and Filters -->
            <div class="network-filters">
              <div class="filter-group">
                <input type="text" id="deviceSearch" placeholder="Search devices..." class="form-control">
                <select id="deviceTypeFilter" class="form-control">
                  <option value="all">All Device Types</option>
                  <option value="internal">Internal Devices</option>
                  <option value="external">External Devices</option>
                  <option value="gateway">Gateways</option>
                  <option value="server">Servers</option>
                  <option value="workstation">Workstations</option>
                </select>
                <select id="protocolFilter" class="form-control">
                  <option value="all">All Protocols</option>
                  <option value="TCP">TCP</option>
                  <option value="UDP">UDP</option>
                  <option value="ICMP">ICMP</option>
                  <option value="HTTP">HTTP</option>
                  <option value="HTTPS">HTTPS</option>
                </select>
                <button class="btn btn-primary" onclick="applyNetworkFilters()"><i class="fas fa-filter"></i> Filter</button>
                <button class="btn btn-secondary" onclick="clearNetworkFilters()"><i class="fas fa-times"></i> Clear</button>
              </div>
            </div>
            
            <!-- Interactive Network Map -->
            <div class="network-map-container">
              <div id="networkTopologyMap" class="network-map enhanced-map"></div>
              
              <!-- Network Statistics Panel -->
              <div class="network-stats-panel">
                <div class="stat-item">
                  <span class="stat-label">Active Devices:</span>
                  <span class="stat-value" id="activeDevicesCount">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Active Connections:</span>
                  <span class="stat-value" id="activeConnectionsCount">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Suspicious Activity:</span>
                  <span class="stat-value text-warning" id="suspiciousActivityCount">0</span>
                </div>
                <div class="stat-item">
                  <span class="stat-label">Blocked IPs:</span>
                  <span class="stat-value text-danger" id="blockedIPsCount">0</span>
                </div>
              </div>
              
              <!-- Enhanced Legend -->
              <div class="enhanced-legend">
                <div class="legend-section">
                  <h4>Device Types</h4>
                  <div class="legend-items">
                    <div class="legend-item"><span class="legend-dot internal"></span>Internal Device</div>
                    <div class="legend-item"><span class="legend-dot external"></span>External Device</div>
                    <div class="legend-item"><span class="legend-dot gateway"></span>Gateway/Router</div>
                    <div class="legend-item"><span class="legend-dot server"></span>Server</div>
                    <div class="legend-item"><span class="legend-dot workstation"></span>Workstation</div>
                  </div>
                </div>
                <div class="legend-section">
                  <h4>Connection Status</h4>
                  <div class="legend-items">
                    <div class="legend-item"><span class="connection-line normal"></span>Normal Traffic</div>
                    <div class="legend-item"><span class="connection-line suspicious"></span>Suspicious Activity</div>
                    <div class="legend-item"><span class="connection-line blocked"></span>Blocked Connection</div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Network Device Details Panel -->
          <div class="chart-container" data-aos="fade-up" data-aos-delay="200">
            <h3><i class="fas fa-info-circle"></i> Device Details</h3>
            <div id="deviceDetailsPanel" class="device-details-panel">
              <p class="text-muted">Click on a device in the network map to view detailed information.</p>
            </div>
          </div>
          
          <!-- Traffic Flow Analysis -->
          <div class="analytics-grid">
            <div class="chart-container">
              <h3><i class="fas fa-exchange-alt"></i> Real-time Traffic Flow</h3>
              <div class="traffic-flow-container">
                <canvas id="trafficFlowChart"></canvas>
              </div>
            </div>
            <div class="chart-container">
              <h3><i class="fas fa-shield-alt"></i> Security Zones</h3>
              <div class="security-zones">
                <div class="zone-item zone-trusted">
                  <div class="zone-header">
                    <i class="fas fa-shield-alt"></i>
                    <span>Trusted Zone</span>
                  </div>
                  <div class="zone-stats">
                    <span>Devices: <strong id="trustedDevices">0</strong></span>
                    <span>Traffic: <strong id="trustedTraffic">0 MB/s</strong></span>
                  </div>
                </div>
                <div class="zone-item zone-dmz">
                  <div class="zone-header">
                    <i class="fas fa-exclamation-triangle"></i>
                    <span>DMZ</span>
                  </div>
                  <div class="zone-stats">
                    <span>Devices: <strong id="dmzDevices">0</strong></span>
                    <span>Traffic: <strong id="dmzTraffic">0 MB/s</strong></span>
                  </div>
                </div>
                <div class="zone-item zone-external">
                  <div class="zone-header">
                    <i class="fas fa-globe"></i>
                    <span>External</span>
                  </div>
                  <div class="zone-stats">
                    <span>Connections: <strong id="externalConnections">0</strong></span>
                    <span>Blocked: <strong id="externalBlocked">0</strong></span>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <!-- Enhanced Settings Section -->
        <div id="settings-section" class="section hidden">
          <!-- Settings Navigation -->
          <div class="settings-nav">
            <button class="settings-tab active" onclick="showSettingsTab('security')">Security Rules</button>
            <button class="settings-tab" onclick="showSettingsTab('notifications')">Notifications</button>
            <button class="settings-tab" onclick="showSettingsTab('monitoring')">Monitoring</button>
            <button class="settings-tab" onclick="showSettingsTab('network')">Network</button>
            <button class="settings-tab" onclick="showSettingsTab('advanced')">Advanced</button>
          </div>
          
          <!-- Security Settings Tab -->
          <div id="security-settings" class="settings-tab-content active">
            <div class="chart-container">
              <h3><i class="fas fa-shield-alt"></i> Security Rules & Detection</h3>
              
              <div class="settings-grid">
                <div class="settings-card">
                  <h4>Intrusion Detection</h4>
                  <div class="form-group">
                    <label>Port Scan Detection Threshold</label>
                    <input type="number" id="portScanThreshold" value="20" min="1" max="100">
                    <small>Number of ports scanned before triggering alert</small>
                  </div>
                  <div class="form-group">
                    <label>SYN Flood Detection Threshold</label>
                    <input type="number" id="synFloodThreshold" value="100" min="10" max="1000">
                    <small>SYN packets per second threshold</small>
                  </div>
                  <div class="form-group">
                    <label>Brute Force Detection</label>
                    <input type="number" id="bruteForceThreshold" value="5" min="1" max="20">
                    <small>Failed login attempts before alert</small>
                  </div>
                </div>
                
                <div class="settings-card">
                  <h4>Auto-Response Actions</h4>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="autoBlock">
                      <span class="checkmark"></span>
                      Auto-Block Malicious IPs
                    </label>
                    <small>Automatically block IPs detected as malicious</small>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="autoQuarantine">
                      <span class="checkmark"></span>
                      Quarantine Suspicious Devices
                    </label>
                    <small>Isolate devices showing suspicious behavior</small>
                  </div>
                  <div class="form-group">
                    <label>Block Duration (minutes)</label>
                    <input type="number" id="blockDuration" value="60" min="5" max="1440">
                    <small>How long to block malicious IPs</small>
                  </div>
                </div>
              </div>
              
              <!-- Custom Security Rules -->
              <div class="settings-card">
                <h4>Custom Security Rules</h4>
                <div class="rules-container">
                  <div class="rule-item">
                    <div class="rule-header">
                      <span>Block Specific IP Ranges</span>
                      <button class="btn btn-sm btn-primary" onclick="addIPRule()">Add Rule</button>
                    </div>
                    <div id="ipRulesList" class="rules-list"></div>
                  </div>
                  
                  <div class="rule-item">
                    <div class="rule-header">
                      <span>Port Access Control</span>
                      <button class="btn btn-sm btn-primary" onclick="addPortRule()">Add Rule</button>
                    </div>
                    <div id="portRulesList" class="rules-list"></div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Notifications Settings Tab -->
          <div id="notifications-settings" class="settings-tab-content">
            <div class="chart-container">
              <h3><i class="fas fa-bell"></i> Notification Preferences</h3>
              
              <div class="settings-grid">
                <div class="settings-card">
                  <h4>Email Notifications</h4>
                  <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" id="emailNotifications" placeholder="your-email@example.com">
                  </div>
                  <div class="form-group">
                    <label>SMTP Server</label>
                    <input type="text" id="smtpServer" placeholder="smtp.gmail.com">
                  </div>
                  <div class="form-group">
                    <label>SMTP Port</label>
                    <input type="number" id="smtpPort" value="587" min="1" max="65535">
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="emailCritical" checked>
                      <span class="checkmark"></span>
                      Critical Alerts
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="emailHigh" checked>
                      <span class="checkmark"></span>
                      High Priority Alerts
                    </label>
                  </div>
                </div>
                
                <div class="settings-card">
                  <h4>Real-time Notifications</h4>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="browserNotifications" checked>
                      <span class="checkmark"></span>
                      Browser Notifications
                    </label>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="soundAlerts">
                      <span class="checkmark"></span>
                      Sound Alerts
                    </label>
                  </div>
                  <div class="form-group">
                    <label>Webhook URL</label>
                    <input type="url" id="webhookUrl" placeholder="https://hooks.slack.com/...">
                    <small>Send alerts to Slack, Discord, or other services</small>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Monitoring Settings Tab -->
          <div id="monitoring-settings" class="settings-tab-content">
            <div class="chart-container">
              <h3><i class="fas fa-chart-line"></i> System Monitoring</h3>
              
              <div class="settings-grid">
                <div class="settings-card">
                  <h4>Performance Monitoring</h4>
                  <div class="form-group">
                    <label>CPU Usage Alert Threshold (%)</label>
                    <input type="number" id="cpuThreshold" value="80" min="50" max="95">
                  </div>
                  <div class="form-group">
                    <label>Memory Usage Alert Threshold (%)</label>
                    <input type="number" id="memoryThreshold" value="85" min="50" max="95">
                  </div>
                  <div class="form-group">
                    <label>Disk Usage Alert Threshold (%)</label>
                    <input type="number" id="diskThreshold" value="90" min="70" max="95">
                  </div>
                </div>
                
                <div class="settings-card">
                  <h4>Data Retention</h4>
                  <div class="form-group">
                    <label>Packet Capture Retention (days)</label>
                    <input type="number" id="packetRetention" value="7" min="1" max="30">
                  </div>
                  <div class="form-group">
                    <label>Alert History Retention (days)</label>
                    <input type="number" id="alertRetention" value="30" min="7" max="365">
                  </div>
                  <div class="form-group">
                    <label>Log File Retention (days)</label>
                    <input type="number" id="logRetention" value="14" min="3" max="90">
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Network Settings Tab -->
          <div id="network-settings" class="settings-tab-content">
            <div class="chart-container">
              <h3><i class="fas fa-network-wired"></i> Network Configuration</h3>
              
              <div class="settings-grid">
                <div class="settings-card">
                  <h4>Network Interfaces</h4>
                  <div class="form-group">
                    <label>Primary Interface</label>
                    <select id="primaryInterface" class="form-control">
                      <option value="auto">Auto-detect</option>
                      <option value="eth0">eth0</option>
                      <option value="wlan0">wlan0</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="promiscuousMode">
                      <span class="checkmark"></span>
                      Enable Promiscuous Mode
                    </label>
                    <small>Capture all network traffic (requires elevated privileges)</small>
                  </div>
                </div>
                
                <div class="settings-card">
                  <h4>Traffic Analysis</h4>
                  <div class="form-group">
                    <label>Deep Packet Inspection</label>
                    <select id="dpiLevel" class="form-control">
                      <option value="basic">Basic</option>
                      <option value="standard">Standard</option>
                      <option value="advanced">Advanced</option>
                    </select>
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="geoipLookup" checked>
                      <span class="checkmark"></span>
                      Enable GeoIP Lookup
                    </label>
                  </div>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Advanced Settings Tab -->
          <div id="advanced-settings" class="settings-tab-content">
            <div class="chart-container">
              <h3><i class="fas fa-cogs"></i> Advanced Configuration</h3>
              
              <div class="settings-grid">
                <div class="settings-card">
                  <h4>API Configuration</h4>
                  <div class="form-group">
                    <label>API Rate Limit (requests/minute)</label>
                    <input type="number" id="apiRateLimit" value="100" min="10" max="1000">
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="apiLogging">
                      <span class="checkmark"></span>
                      Enable API Logging
                    </label>
                  </div>
                </div>
                
                <div class="settings-card">
                  <h4>Database Settings</h4>
                  <div class="form-group">
                    <label>Database Cleanup Interval (hours)</label>
                    <input type="number" id="dbCleanupInterval" value="24" min="1" max="168">
                  </div>
                  <div class="form-group">
                    <label class="checkbox-label">
                      <input type="checkbox" id="dbBackup" checked>
                      <span class="checkmark"></span>
                      Enable Automatic Backups
                    </label>
                  </div>
                </div>
              </div>
              
              <!-- System Actions -->
              <div class="settings-card">
                <h4>System Actions</h4>
                <div class="action-buttons">
                  <button class="btn btn-warning" onclick="exportSettings()"><i class="fas fa-download"></i> Export Settings</button>
                  <button class="btn btn-primary" onclick="importSettings()"><i class="fas fa-upload"></i> Import Settings</button>
                  <button class="btn btn-danger" onclick="resetSettings()"><i class="fas fa-undo"></i> Reset to Defaults</button>
                  <button class="btn btn-info" onclick="testConfiguration()"><i class="fas fa-check"></i> Test Configuration</button>
                </div>
              </div>
            </div>
          </div>
          
          <!-- Settings Actions -->
          <div class="settings-actions">
            <button class="btn btn-success" onclick="saveAllSettings()"><i class="fas fa-save"></i> Save All Settings</button>
            <button class="btn btn-secondary" onclick="cancelSettings()"><i class="fas fa-times"></i> Cancel Changes</button>
          </div>
        </div>
      </div>
    </div>

    <!-- Block IP Modal -->
    <div id="blockIPModal" class="modal">
      <div class="modal-content">
        <span class="close" onclick="closeModal()">&times;</span>
        <h3>Block IP Address</h3>
        <div class="form-group">
          <label>IP Address to Block</label>
          <input
            type="text"
            id="ipToBlock"
            placeholder="192.168.1.100"
            pattern="^(\d{1,3}\.){3}\d{1,3}$"
          />
        </div>
        <div class="form-group">
          <label>Reason</label>
          <input
            type="text"
            id="blockReason"
            placeholder="Malicious activity detected"
          />
        </div>
        <button class="btn btn-danger" onclick="blockIP()">Block IP</button>
        <button class="btn btn-primary" onclick="closeModal()">Cancel</button>
      </div>
    </div>

    <script >
      // Global variables
let isCapturing = true;
let packetCount = 0;
let alertCount = 0;
let eventSource = null;
let trafficChart = null;
let alertChart = null;
let protocolChart = null;
let portsChart = null;
let hourlyChart = null;
let trafficFlowChart = null;
let networkSvg = null;
let networkSimulation = null;
let currentNetworkLayout = 'force';
let networkData = { nodes: [], links: [] };
let filteredNetworkData = { nodes: [], links: [] };
let notyf = null;

// API configuration
const API_KEY = "your-api-key-here"; // Should be stored securely
const API_BASE = window.location.origin;

// Initialize dashboard
document.addEventListener("DOMContentLoaded", function () {
  // Initialize AOS animations
  AOS.init({
    duration: 800,
    easing: "ease-in-out-sine",
    once: true,
  });

  // Initialize notification system
  notyf = new Notyf({
    duration: 4000,
    position: {
      x: 'right',
      y: 'top',
    },
    types: [
      {
        type: 'success',
        background: 'var(--success-emerald)',
        icon: {
          className: 'fas fa-check',
          tagName: 'i',
          color: 'white'
        }
      },
      {
        type: 'error',
        background: 'var(--danger-red)',
        icon: {
          className: 'fas fa-times',
          tagName: 'i',
          color: 'white'
        }
      },
      {
        type: 'warning',
        background: 'var(--warning-amber)',
        icon: {
          className: 'fas fa-exclamation-triangle',
          tagName: 'i',
          color: 'white'
        }
      }
    ]
  });

  // Initialize particles background
  initializeParticles();

  // Initialize charts with modern configurations
  initializeCharts();
  initializeNetworkMap();
  connectEventStream();
  loadInitialData();
  loadSettings();
  loadNetworkRules();

  // Update stats every 30 seconds
  setInterval(updateStats, 30000);
  
  // Update network map every 15 seconds
  setInterval(updateNetworkMap, 15000);
});

function initializeParticles() {
  particlesJS("particles-js", {
    particles: {
      number: { value: 80, density: { enable: true, value_area: 800 } },
      color: { value: "#4facfe" },
      shape: { type: "circle" },
      opacity: { value: 0.5, random: false },
      size: { value: 3, random: true },
      line_linked: {
        enable: true,
        distance: 150,
        color: "#4facfe",
        opacity: 0.4,
        width: 1,
      },
      move: {
        enable: true,
        speed: 6,
        direction: "none",
        random: false,
        straight: false,
        out_mode: "out",
        bounce: false,
      },
    },
    interactivity: {
      detect_on: "canvas",
      events: {
        onhover: { enable: true, mode: "repulse" },
        onclick: { enable: true, mode: "push" },
        resize: true,
      },
    },
    retina_detect: true,
  });
}

function initializeCharts() {
  // Modern Traffic Chart with gradient
  const trafficCtx = document.getElementById("trafficChart").getContext("2d");

  // Create gradient
  const trafficGradient = trafficCtx.createLinearGradient(0, 0, 0, 400);
  trafficGradient.addColorStop(0, "rgba(79, 172, 254, 0.8)");
  trafficGradient.addColorStop(0.5, "rgba(0, 242, 254, 0.4)");
  trafficGradient.addColorStop(1, "rgba(79, 172, 254, 0.1)");

  trafficChart = new Chart(trafficCtx, {
    type: "line",
    data: {
      labels: [],
      datasets: [
        {
          label: "Packets/Second",
          data: [],
          borderColor: "#4facfe",
          backgroundColor: trafficGradient,
          borderWidth: 3,
          fill: true,
          tension: 0.4,
          pointBackgroundColor: "#4facfe",
          pointBorderColor: "#ffffff",
          pointBorderWidth: 2,
          pointRadius: 5,
          pointHoverRadius: 8,
          pointHoverBackgroundColor: "#00f2fe",
          pointHoverBorderColor: "#ffffff",
          pointHoverBorderWidth: 3,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        intersect: false,
        mode: "index",
      },
      plugins: {
        legend: {
          labels: {
            color: "#ffffff",
            font: { size: 14, weight: "bold" },
            usePointStyle: true,
            padding: 20,
          },
        },
        tooltip: {
          backgroundColor: "rgba(0, 0, 0, 0.8)",
          titleColor: "#ffffff",
          bodyColor: "#ffffff",
          borderColor: "#4facfe",
          borderWidth: 1,
          cornerRadius: 10,
          displayColors: false,
        },
      },
      scales: {
        x: {
          ticks: {
            color: "#ffffff",
            font: { size: 12 },
          },
          grid: {
            color: "rgba(255,255,255,0.1)",
            drawBorder: false,
          },
        },
        y: {
          ticks: {
            color: "#ffffff",
            font: { size: 12 },
          },
          grid: {
            color: "rgba(255,255,255,0.1)",
            drawBorder: false,
          },
          beginAtZero: true,
        },
      },
      animation: {
        duration: 2000,
        easing: "easeInOutQuart",
      },
    },
  });

  // Modern Alert Chart with 3D effect
  const alertCtx = document.getElementById("alertChart").getContext("2d");
  alertChart = new Chart(alertCtx, {
    type: "doughnut",
    data: {
      labels: ["Critical", "High", "Medium", "Low"],
      datasets: [
        {
          data: [0, 0, 0, 0],
          backgroundColor: [
            "rgba(255, 71, 87, 0.8)",
            "rgba(255, 165, 0, 0.8)",
            "rgba(255, 193, 7, 0.8)",
            "rgba(40, 167, 69, 0.8)",
          ],
          borderColor: ["#ff4757", "#ffa500", "#ffc107", "#28a745"],
          borderWidth: 3,
          hoverBackgroundColor: [
            "rgba(255, 71, 87, 1)",
            "rgba(255, 165, 0, 1)",
            "rgba(255, 193, 7, 1)",
            "rgba(40, 167, 69, 1)",
          ],
          hoverBorderWidth: 4,
          cutout: "60%",
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: "#ffffff",
            font: { size: 14, weight: "bold" },
            usePointStyle: true,
            padding: 20,
          },
          position: "bottom",
        },
        tooltip: {
          backgroundColor: "rgba(0, 0, 0, 0.8)",
          titleColor: "#ffffff",
          bodyColor: "#ffffff",
          borderColor: "#4facfe",
          borderWidth: 1,
          cornerRadius: 10,
          callbacks: {
            label: function (context) {
              const label = context.label || "";
              const value = context.parsed || 0;
              const total = context.dataset.data.reduce((a, b) => a + b, 0);
              const percentage =
                total > 0 ? ((value / total) * 100).toFixed(1) : 0;
              return `${label}: ${value} (${percentage}%)`;
            },
          },
        },
      },
      animation: {
        animateRotate: true,
        animateScale: true,
        duration: 2000,
        easing: "easeInOutQuart",
      },
    },
  });

  // Modern Protocol Distribution Chart
  const protocolCtx = document.getElementById("protocolChart").getContext("2d");
  window.protocolChart = new Chart(protocolCtx, {
    type: "pie",
    data: {
      labels: [],
      datasets: [
        {
          data: [],
          backgroundColor: [
            "rgba(79, 172, 254, 0.8)",
            "rgba(255, 107, 107, 0.8)",
            "rgba(78, 205, 196, 0.8)",
            "rgba(69, 183, 209, 0.8)",
            "rgba(150, 206, 180, 0.8)",
            "rgba(254, 202, 87, 0.8)",
          ],
          borderColor: [
            "#4facfe",
            "#ff6b6b",
            "#4ecdc4",
            "#45b7d1",
            "#96ceb4",
            "#feca57",
          ],
          borderWidth: 3,
          hoverBackgroundColor: [
            "rgba(79, 172, 254, 1)",
            "rgba(255, 107, 107, 1)",
            "rgba(78, 205, 196, 1)",
            "rgba(69, 183, 209, 1)",
            "rgba(150, 206, 180, 1)",
            "rgba(254, 202, 87, 1)",
          ],
          hoverBorderWidth: 4,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: "#ffffff",
            font: { size: 14, weight: "bold" },
            usePointStyle: true,
            padding: 15,
          },
          position: "right",
        },
        tooltip: {
          backgroundColor: "rgba(0, 0, 0, 0.8)",
          titleColor: "#ffffff",
          bodyColor: "#ffffff",
          borderColor: "#4facfe",
          borderWidth: 1,
          cornerRadius: 10,
        },
      },
      animation: {
        animateRotate: true,
        animateScale: true,
        duration: 2000,
        easing: "easeInOutQuart",
      },
    },
  });

  // Modern Top Ports Chart with gradient bars
  const portsCtx = document.getElementById("portsChart").getContext("2d");
  const portsGradient = portsCtx.createLinearGradient(0, 0, 0, 400);
  portsGradient.addColorStop(0, "rgba(79, 172, 254, 0.9)");
  portsGradient.addColorStop(1, "rgba(0, 242, 254, 0.6)");

  window.portsChart = new Chart(portsCtx, {
    type: "bar",
    data: {
      labels: [],
      datasets: [
        {
          label: "Connection Count",
          data: [],
          backgroundColor: portsGradient,
          borderColor: "#4facfe",
          borderWidth: 2,
          borderRadius: 8,
          borderSkipped: false,
          hoverBackgroundColor: "rgba(79, 172, 254, 1)",
          hoverBorderColor: "#00f2fe",
          hoverBorderWidth: 3,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      plugins: {
        legend: {
          labels: {
            color: "#ffffff",
            font: { size: 14, weight: "bold" },
            usePointStyle: true,
            padding: 20,
          },
        },
        tooltip: {
          backgroundColor: "rgba(0, 0, 0, 0.8)",
          titleColor: "#ffffff",
          bodyColor: "#ffffff",
          borderColor: "#4facfe",
          borderWidth: 1,
          cornerRadius: 10,
        },
      },
      scales: {
        x: {
          ticks: {
            color: "#ffffff",
            font: { size: 12 },
          },
          grid: {
            color: "rgba(255,255,255,0.1)",
            drawBorder: false,
          },
        },
        y: {
          ticks: {
            color: "#ffffff",
            font: { size: 12 },
          },
          grid: {
            color: "rgba(255,255,255,0.1)",
            drawBorder: false,
          },
          beginAtZero: true,
        },
      },
      animation: {
        duration: 2000,
        easing: "easeInOutQuart",
      },
    },
  });

  // Modern Hourly Traffic Chart with area fill
  const hourlyCtx = document.getElementById("hourlyChart").getContext("2d");
  const hourlyGradient = hourlyCtx.createLinearGradient(0, 0, 0, 400);
  hourlyGradient.addColorStop(0, "rgba(78, 205, 196, 0.8)");
  hourlyGradient.addColorStop(0.5, "rgba(78, 205, 196, 0.4)");
  hourlyGradient.addColorStop(1, "rgba(78, 205, 196, 0.1)");

  window.hourlyChart = new Chart(hourlyCtx, {
    type: "line",
    data: {
      labels: [],
      datasets: [
        {
          label: "Packets per Hour",
          data: [],
          borderColor: "#4ecdc4",
          backgroundColor: hourlyGradient,
          borderWidth: 3,
          tension: 0.4,
          fill: true,
          pointBackgroundColor: "#4ecdc4",
          pointBorderColor: "#ffffff",
          pointBorderWidth: 2,
          pointRadius: 6,
          pointHoverRadius: 10,
          pointHoverBackgroundColor: "#38f9d7",
          pointHoverBorderColor: "#ffffff",
          pointHoverBorderWidth: 3,
        },
      ],
    },
    options: {
      responsive: true,
      maintainAspectRatio: false,
      interaction: {
        intersect: false,
        mode: "index",
      },
      plugins: {
        legend: {
          labels: {
            color: "#ffffff",
            font: { size: 14, weight: "bold" },
            usePointStyle: true,
            padding: 20,
          },
        },
        tooltip: {
          backgroundColor: "rgba(0, 0, 0, 0.8)",
          titleColor: "#ffffff",
          bodyColor: "#ffffff",
          borderColor: "#4ecdc4",
          borderWidth: 1,
          cornerRadius: 10,
          displayColors: false,
        },
      },
      scales: {
        x: {
          ticks: {
            color: "#ffffff",
            font: { size: 12 },
          },
          grid: {
            color: "rgba(255,255,255,0.1)",
            drawBorder: false,
          },
        },
        y: {
          ticks: {
            color: "#ffffff",
            font: { size: 12 },
          },
          grid: {
            color: "rgba(255,255,255,0.1)",
            drawBorder: false,
          },
          beginAtZero: true,
        },
      },
      animation: {
        duration: 2000,
        easing: "easeInOutQuart",
      },
    },
  });
}

function connectEventStream() {
  if (eventSource) {
    eventSource.close();
  }

  eventSource = new EventSource("/events");

  eventSource.onmessage = function (event) {
    try {
      const data = JSON.parse(event.data);

      if (data.type === "packet") {
        handleNewPacket(data.data);
      } else if (data.type === "alert") {
        handleNewAlert(data.data);
      }
    } catch (error) {
      console.error("Error parsing event data:", error);
    }
  };

  eventSource.onerror = function (event) {
    console.error("EventSource error:", event);
    document.getElementById("statusDot").className =
      "status-dot status-critical";
    document.getElementById("statusText").textContent = "Connection Lost";

    // Attempt to reconnect after 5 seconds
    setTimeout(connectEventStream, 5000);
  };

  eventSource.onopen = function (event) {
    document.getElementById("statusDot").className = "status-dot status-online";
    document.getElementById("statusText").textContent = "Monitoring Active";
  };
}

function handleNewPacket(packet) {
  if (!isCapturing) return;

  packetCount++;
  updatePacketDisplay(packet);
  updateTrafficChart();

  // Update packet count display
  document.getElementById("totalPackets").textContent =
    packetCount.toLocaleString();
}

function handleNewAlert(alert) {
  alertCount++;
  addAlertToDisplay(alert);
  updateAlertChart();

  // Update alert count display
  document.getElementById("totalAlerts").textContent =
    alertCount.toLocaleString();

  // Show notification for critical alerts
  if (alert.severity === "CRITICAL") {
    showNotification("Critical Security Alert", alert.message);
  }
}

function updatePacketDisplay(packet) {
  const tbody = document.getElementById("packetsTableBody");

  // Remove loading message if present
  if (tbody.children.length === 1 && tbody.children[0].children.length === 1) {
    tbody.innerHTML = "";
  }

  const row = document.createElement("tr");
  row.innerHTML = `
                <td>${new Date(packet.time_stamp).toLocaleTimeString()}</td>
                <td>${packet.ipsrc}</td>
                <td>${packet.ipdst}</td>
                <td>${packet.transport_layer}</td>
                <td>${packet.srcport}</td>
                <td>${packet.dstnport}</td>
                <td>${packet.highest_layer}</td>
            `;

  tbody.insertBefore(row, tbody.firstChild);

  // Keep only last 50 packets in display
  if (tbody.children.length > 50) {
    tbody.removeChild(tbody.lastChild);
  }
}

function addAlertToDisplay(alert) {
  const alertsList = document.getElementById("alertsList");

  // Remove loading message if present
  if (
    alertsList.children.length === 1 &&
    alertsList.children[0].classList.contains("loading")
  ) {
    alertsList.innerHTML = "";
  }

  const alertDiv = document.createElement("div");
  alertDiv.className = `alert-item alert-${alert.severity.toLowerCase()}`;
  alertDiv.innerHTML = `
                <div class="alert-severity severity-${alert.severity.toLowerCase()}">${
    alert.severity
  }</div>
                <div class="alert-content">
                    <div><strong>${alert.alert_type.replace(
                      "_",
                      " "
                    )}</strong></div>
                    <div>${alert.message}</div>
                    <div class="alert-time">${new Date(
                      alert.timestamp
                    ).toLocaleString()}</div>
                </div>
            `;

  alertsList.insertBefore(alertDiv, alertsList.firstChild);

  // Keep only last 20 alerts in display
  if (alertsList.children.length > 20) {
    alertsList.removeChild(alertsList.lastChild);
  }
}

function updateTrafficChart() {
  const now = new Date();
  const timeLabel = now.toLocaleTimeString();

  trafficChart.data.labels.push(timeLabel);
  trafficChart.data.datasets[0].data.push(Math.random() * 100); // Mock data

  // Keep only last 20 data points
  if (trafficChart.data.labels.length > 20) {
    trafficChart.data.labels.shift();
    trafficChart.data.datasets[0].data.shift();
  }

  trafficChart.update("active");
}

function updateAlertChart() {
  // Mock alert distribution data with smooth animation
  alertChart.data.datasets[0].data = [
    Math.floor(Math.random() * 5),
    Math.floor(Math.random() * 10),
    Math.floor(Math.random() * 15),
    Math.floor(Math.random() * 8),
  ];
  alertChart.update("active");
}

function loadInitialData() {
  // Load network stats
  fetch(`${API_BASE}/network_stats`, {
    headers: {
      "X-API-Key": API_KEY,
    },
  })
    .then((response) => response.json())
    .then((data) => {
      document.getElementById("blockedIPs").textContent =
        data.blacklisted_ips || 0;
      document.getElementById("networkDevices").textContent =
        data.known_devices || 0;
    })
    .catch((error) => console.error("Error loading network stats:", error));

  // Load additional data for overview section
  loadNetworkTopology("overviewNetworkMap");
  loadTrafficAnalytics();
  loadThreatIndicators();
}

function updateStats() {
  loadInitialData();
  // Refresh additional charts and data
  if (
    document.getElementById("overview-section").classList.contains("hidden") ===
    false
  ) {
    loadNetworkTopology("overviewNetworkMap");
    loadTrafficAnalytics();
    loadThreatIndicators();
  }
}

function showSection(sectionName) {
  // Hide all sections
  document.querySelectorAll(".section").forEach((section) => {
    section.classList.add("hidden");
  });

  // Remove active class from all nav items
  document.querySelectorAll(".nav-item").forEach((item) => {
    item.classList.remove("active");
  });

  // Show selected section
  document.getElementById(`${sectionName}-section`).classList.remove("hidden");

  // Add active class to clicked nav item
  event.target.classList.add("active");
}

function toggleCapture() {
  isCapturing = !isCapturing;
  const button = event.target;
  button.textContent = isCapturing ? "Pause Capture" : "Resume Capture";
  button.className = isCapturing ? "btn btn-primary" : "btn btn-danger";
}

function showBlockIPModal() {
  document.getElementById("blockIPModal").style.display = "block";
}

function closeModal() {
  document.getElementById("blockIPModal").style.display = "none";
}

function blockIP() {
  const ip = document.getElementById("ipToBlock").value;
  const reason = document.getElementById("blockReason").value;

  if (!ip) {
    alert("Please enter an IP address");
    return;
  }

  fetch(`${API_BASE}/block_ip`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-API-Key": API_KEY,
    },
    body: JSON.stringify({ ip: ip, reason: reason }),
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.error) {
        alert(`Error: ${data.error}`);
      } else {
        alert(`IP ${ip} has been blocked successfully`);
        closeModal();
        document.getElementById("ipToBlock").value = "";
        document.getElementById("blockReason").value = "";
      }
    })
    .catch((error) => {
      console.error("Error blocking IP:", error);
      alert("Failed to block IP. Please try again.");
    });
}

function clearAlerts() {
  document.getElementById("alertsList").innerHTML =
    '<div class="loading"><p>No alerts</p></div>';
  alertCount = 0;
  document.getElementById("totalAlerts").textContent = "0";
}

function exportPackets() {
  // Create CSV content
  const packets = Array.from(
    document.getElementById("packetsTableBody").children
  );
  let csv =
    "Timestamp,Source IP,Destination IP,Protocol,Source Port,Dest Port,Layer\n";

  packets.forEach((row) => {
    const cells = Array.from(row.children);
    csv += cells.map((cell) => cell.textContent).join(",") + "\n";
  });

  // Download CSV
  const blob = new Blob([csv], { type: "text/csv" });
  const url = window.URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = url;
  a.download = `network_packets_${new Date().toISOString().split("T")[0]}.csv`;
  a.click();
  window.URL.revokeObjectURL(url);
}

function refreshNetwork() {
  document.getElementById("networkMap").innerHTML =
    '<div class="loading"><div class="spinner"></div><p>Refreshing network map...</p></div>';

  // Load network topology data
  loadNetworkTopology();
  loadTrafficAnalytics();
  loadThreatIndicators();
}

function loadNetworkTopology(containerId) {
  fetch(`${API_BASE}/network_topology`, {
    headers: {
      "X-API-Key": API_KEY,
    },
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.error) {
        console.error("Error loading topology:", data.error);
        return;
      }
      renderNetworkMap(data, containerId || "networkMap");
    })
    .catch((error) => {
      console.error("Error loading network topology:", error);
    });
}

function renderNetworkMap(data, containerId) {
  const mapContainer = document.getElementById(containerId || "networkMap");
  mapContainer.innerHTML = "";

  if (!data.devices || data.devices.length === 0) {
    mapContainer.innerHTML = "<p>No network devices detected yet</p>";
    return;
  }

  // Simple network map visualization
  const map = document.createElement("div");
  map.style.position = "relative";
  map.style.width = "100%";
  map.style.height = "100%";

  // Position devices in a circle
  const centerX = 200;
  const centerY = 200;
  const radius = 150;
  const angleStep = (2 * Math.PI) / data.devices.length;

  data.devices.forEach((device, index) => {
    const angle = index * angleStep;
    const x = centerX + radius * Math.cos(angle);
    const y = centerY + radius * Math.sin(angle);

    const deviceNode = document.createElement("div");
    deviceNode.style.position = "absolute";
    deviceNode.style.left = x + "px";
    deviceNode.style.top = y + "px";
    deviceNode.style.width = "20px";
    deviceNode.style.height = "20px";
    deviceNode.style.borderRadius = "50%";
    deviceNode.style.border = "2px solid white";
    deviceNode.style.backgroundColor =
      device.type === "internal" ? "#00ff88" : "#ff6b6b";
    deviceNode.style.cursor = "pointer";
    deviceNode.title = `${device.ip}\nType: ${
      device.type
    }\nProtocols: ${device.protocols.join(", ")}`;

    // Add device label
    const label = document.createElement("div");
    label.style.position = "absolute";
    label.style.left = "25px";
    label.style.top = "0px";
    label.style.color = "white";
    label.style.fontSize = "10px";
    label.style.whiteSpace = "nowrap";
    label.textContent = device.ip.split(".").slice(-1)[0]; // Show last octet
    deviceNode.appendChild(label);

    map.appendChild(deviceNode);
  });

  // Add connections
  data.connections.forEach((connection) => {
    const sourceDevice = data.devices.find((d) => d.ip === connection.source);
    const targetDevice = data.devices.find((d) => d.ip === connection.target);

    if (sourceDevice && targetDevice) {
      const sourceIndex = data.devices.indexOf(sourceDevice);
      const targetIndex = data.devices.indexOf(targetDevice);

      const sourceAngle = sourceIndex * angleStep;
      const targetAngle = targetIndex * angleStep;

      const sourceX = centerX + radius * Math.cos(sourceAngle);
      const sourceY = centerY + radius * Math.sin(sourceAngle);
      const targetX = centerX + radius * Math.cos(targetAngle);
      const targetY = centerY + radius * Math.sin(targetAngle);

      // Create SVG line for connection
      const svg = document.createElementNS("http://www.w3.org/2000/svg", "svg");
      svg.style.position = "absolute";
      svg.style.left = "0px";
      svg.style.top = "0px";
      svg.style.width = "100%";
      svg.style.height = "100%";
      svg.style.pointerEvents = "none";

      const line = document.createElementNS(
        "http://www.w3.org/2000/svg",
        "line"
      );
      line.setAttribute("x1", sourceX);
      line.setAttribute("y1", sourceY);
      line.setAttribute("x2", targetX);
      line.setAttribute("y2", targetY);
      line.setAttribute("stroke", "rgba(255, 255, 255, 0.3)");
      line.setAttribute("stroke-width", "1");

      svg.appendChild(line);
      map.appendChild(svg);
    }
  });

  mapContainer.appendChild(map);
}

function loadTrafficAnalytics() {
  fetch(`${API_BASE}/traffic_analytics`, {
    headers: {
      "X-API-Key": API_KEY,
    },
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.error) {
        console.error("Error loading analytics:", data.error);
        return;
      }
      updateAnalyticsCharts(data);
    })
    .catch((error) => {
      console.error("Error loading traffic analytics:", error);
    });
}

function updateAnalyticsCharts(data) {
  // Update Protocol Distribution Chart
  if (window.protocolChart && data.protocol_distribution) {
    window.protocolChart.data.labels = Object.keys(data.protocol_distribution);
    const protocolValues = Object.values(data.protocol_distribution);
    if (window.protocolChart.data.labels.length === 0) {
      window.protocolChart.data.labels = ["No Data"];
      window.protocolChart.data.datasets[0].data = [1];
    } else {
      window.protocolChart.data.datasets[0].data = protocolValues;
    }
    window.protocolChart.update();
  }

  // Update Top Ports Chart
  if (window.portsChart && data.top_destination_ports) {
    const ports = data.top_destination_ports || [];
    if (ports.length === 0) {
      window.portsChart.data.labels = ["No Data"];
      window.portsChart.data.datasets[0].data = [0];
    } else {
      window.portsChart.data.labels = ports.map((p) => p.port);
      window.portsChart.data.datasets[0].data = ports.map((p) => p.count);
    }
    window.portsChart.update();
  }

  // Update Hourly Traffic Chart
  if (window.hourlyChart && data.hourly_traffic) {
    const hourly = data.hourly_traffic || {};
    const labels = Object.keys(hourly).sort(
      (a, b) => new Date(a) - new Date(b)
    );
    if (labels.length === 0) {
      window.hourlyChart.data.labels = ["No Data"];
      window.hourlyChart.data.datasets[0].data = [0];
    } else {
      window.hourlyChart.data.labels = labels;
      window.hourlyChart.data.datasets[0].data = labels.map((k) => hourly[k]);
    }
    window.hourlyChart.update();
  }
}

function loadThreatIndicators() {
  fetch(`${API_BASE}/threat_indicators`, {
    headers: {
      "X-API-Key": API_KEY,
    },
  })
    .then((response) => response.json())
    .then((data) => {
      if (data.error) {
        console.error("Error loading threat indicators:", data.error);
        return;
      }
      updateRiskMeter(data);
    })
    .catch((error) => {
      console.error("Error loading threat indicators:", error);
    });
}

function updateRiskMeter(data) {
  // Update risk score
  document.getElementById("riskScore").textContent = data.risk_score;
  document.getElementById("riskLevel").textContent = data.risk_level;
  document.getElementById(
    "riskLevel"
  ).className = `risk-level ${data.risk_level}`;

  // Update risk bar
  const riskFill = document.getElementById("riskFill");
  riskFill.style.width = data.risk_score + "%";

  // Update risk factors
  const riskFactorsContainer = document.getElementById("riskFactors");
  riskFactorsContainer.innerHTML = "";

  if (data.recommendations) {
    data.recommendations.forEach((recommendation, index) => {
      if (recommendation) {
        const factor = document.createElement("div");
        factor.className = "risk-factor";
        factor.innerHTML = `<strong>Recommendation ${
          index + 1
        }:</strong> ${recommendation}`;
        riskFactorsContainer.appendChild(factor);
      }
    });
  }
}

function saveSettings() {
  const settings = {
    portScanThreshold: document.getElementById("portScanThreshold").value,
    synFloodThreshold: document.getElementById("synFloodThreshold").value,
    autoBlock: document.getElementById("autoBlock").checked,
    emailNotifications: document.getElementById("emailNotifications").value,
  };

  fetch(`${API_BASE}/settings`, {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "X-API-Key": API_KEY,
    },
    body: JSON.stringify(settings),
  })
    .then((r) => r.json())
    .then((resp) => {
      if (resp.error) {
        alert(`Failed to save settings: ${resp.error}`);
      } else {
        alert("Settings saved successfully!");
      }
    })
    .catch((e) => {
      console.error("Save settings failed", e);
      alert("Failed to save settings");
    });
}

function loadSettings() {
  fetch(`${API_BASE}/settings`, {
    headers: {
      "X-API-Key": API_KEY,
    },
  })
    .then((r) => r.json())
    .then((s) => {
      if (!s) return;
      if (typeof s.port_scan_threshold !== "undefined") {
        document.getElementById("portScanThreshold").value =
          s.port_scan_threshold;
      }
      if (typeof s.syn_flood_threshold !== "undefined") {
        document.getElementById("synFloodThreshold").value =
          s.syn_flood_threshold;
      }
      if (typeof s.auto_block !== "undefined") {
        document.getElementById("autoBlock").checked = !!s.auto_block;
      }
    })
    .catch((e) => console.error("Failed to load settings", e));
}

function showNotification(title, message) {
  if (Notification.permission === "granted") {
    new Notification(title, {
      body: message,
      icon: "/static/icon.png",
    });
  } else if (Notification.permission !== "denied") {
    Notification.requestPermission().then((permission) => {
      if (permission === "granted") {
        new Notification(title, {
          body: message,
          icon: "/static/icon.png",
        });
      }
    });
  }
}

// Request notification permission on page load
if ("Notification" in window && Notification.permission === "default") {
  Notification.requestPermission();
}

// Handle modal clicks outside content
window.onclick = function (event) {
  const modal = document.getElementById("blockIPModal");
  if (event.target === modal) {
    modal.style.display = "none";
  }
};

// Handle escape key for modals
document.addEventListener("keydown", function (event) {
  if (event.key === "Escape") {
    closeModal();
  }
});

// Auto-refresh alerts every 10 seconds
setInterval(() => {
  if (!document.getElementById("alerts-section").classList.contains("hidden")) {
    // Refresh alerts if alerts section is visible
    loadAlerts();
  }
}, 10000);

function loadAlerts() {
  fetch(`${API_BASE}/alerts`, {
    headers: {
      "X-API-Key": API_KEY,
    },
  })
    .then((response) => response.json())
    .then((alerts) => {
      const alertsList = document.getElementById("alertsList");
      alertsList.innerHTML = "";

      if (alerts.length === 0) {
        alertsList.innerHTML = '<div class="loading"><p>No alerts</p></div>';
        return;
      }

      alerts.forEach((alert) => {
        addAlertToDisplay(alert);
      });
    })
    .catch((error) => {
      console.error("Error loading alerts:", error);
    });
}

// Enhanced Network Map Functions
function initializeNetworkMap() {
  const container = d3.select("#networkTopologyMap");
  const width = 800;
  const height = 500;
  
  networkSvg = container.append("svg")
    .attr("width", "100%")
    .attr("height", "100%")
    .attr("viewBox", `0 0 ${width} ${height}`)
    .style("background", "transparent");

  // Add zoom behavior
  const zoom = d3.zoom()
    .scaleExtent([0.1, 4])
    .on("zoom", (event) => {
      networkSvg.select(".network-group").attr("transform", event.transform);
    });

  networkSvg.call(zoom);

  // Create main group for network elements
  networkSvg.append("g").attr("class", "network-group");

  // Initialize simulation
  networkSimulation = d3.forceSimulation()
    .force("link", d3.forceLink().id(d => d.id).distance(100))
    .force("charge", d3.forceManyBody().strength(-300))
    .force("center", d3.forceCenter(width / 2, height / 2))
    .force("collision", d3.forceCollide().radius(30));

  loadNetworkData();
}

function loadNetworkData() {
  fetch(`${API_BASE}/network_topology`, {
    headers: { "X-API-Key": API_KEY }
  })
    .then(response => response.json())
    .then(data => {
      if (data.devices && data.connections) {
        networkData = {
          nodes: data.devices.map(device => ({
            id: device.ip,
            type: device.type || 'internal',
            protocols: device.protocols || [],
            connections: device.connections || 0,
            suspicious: device.suspicious || false,
            blocked: device.blocked || false
          })),
          links: data.connections.map(conn => ({
            source: conn.source,
            target: conn.target,
            type: conn.type || 'normal',
            traffic: conn.traffic || 0
          }))
        };
        
        filteredNetworkData = JSON.parse(JSON.stringify(networkData));
        renderNetworkVisualization();
        updateNetworkStats();
      }
    })
    .catch(error => console.error("Error loading network data:", error));
}

function renderNetworkVisualization() {
  const svg = networkSvg.select(".network-group");
  
  // Clear existing elements
  svg.selectAll("*").remove();

  // Create links
  const links = svg.selectAll(".link")
    .data(filteredNetworkData.links)
    .enter().append("line")
    .attr("class", "link")
    .attr("stroke", d => {
      switch(d.type) {
        case 'suspicious': return '#fbbf24';
        case 'blocked': return '#ef4444';
        default: return 'rgba(255,255,255,0.3)';
      }
    })
    .attr("stroke-width", d => Math.max(1, d.traffic / 10));

  // Create nodes
  const nodes = svg.selectAll(".node")
    .data(filteredNetworkData.nodes)
    .enter().append("g")
    .attr("class", "node")
    .call(d3.drag()
      .on("start", dragstarted)
      .on("drag", dragged)
      .on("end", dragended));

  nodes.append("circle")
    .attr("r", 15)
    .attr("fill", d => {
      if (d.blocked) return '#ef4444';
      if (d.suspicious) return '#fbbf24';
      switch(d.type) {
        case 'gateway': return '#00d4ff';
        case 'server': return '#8b5cf6';
        case 'workstation': return '#fbbf24';
        case 'external': return '#ef4444';
        default: return '#00ff41';
      }
    })
    .attr("stroke", "#fff")
    .attr("stroke-width", 2);

  nodes.append("text")
    .attr("dx", 20)
    .attr("dy", 5)
    .style("font-size", "10px")
    .style("fill", "#fff")
    .text(d => d.id.split('.').pop());

  // Add click handler for device details
  nodes.on("click", showDeviceDetails);

  // Update simulation
  networkSimulation.nodes(filteredNetworkData.nodes);
  networkSimulation.force("link").links(filteredNetworkData.links);
  networkSimulation.on("tick", () => {
    links
      .attr("x1", d => d.source.x)
      .attr("y1", d => d.source.y)
      .attr("x2", d => d.target.x)
      .attr("y2", d => d.target.y);

    nodes.attr("transform", d => `translate(${d.x},${d.y})`);
  });

  networkSimulation.restart();
}

function dragstarted(event, d) {
  if (!event.active) networkSimulation.alphaTarget(0.3).restart();
  d.fx = d.x;
  d.fy = d.y;
}

function dragged(event, d) {
  d.fx = event.x;
  d.fy = event.y;
}

function dragended(event, d) {
  if (!event.active) networkSimulation.alphaTarget(0);
  d.fx = null;
  d.fy = null;
}

function showDeviceDetails(event, device) {
  const panel = document.getElementById('deviceDetailsPanel');
  panel.innerHTML = `
    <div class="device-info">
      <div class="info-item">
        <div class="info-label">IP Address</div>
        <div class="info-value">${device.id}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Device Type</div>
        <div class="info-value">${device.type}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Protocols</div>
        <div class="info-value">${device.protocols.join(', ')}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Connections</div>
        <div class="info-value">${device.connections}</div>
      </div>
      <div class="info-item">
        <div class="info-label">Status</div>
        <div class="info-value ${device.blocked ? 'text-danger' : device.suspicious ? 'text-warning' : 'text-success'}">
          ${device.blocked ? 'Blocked' : device.suspicious ? 'Suspicious' : 'Normal'}
        </div>
      </div>
    </div>
    <div style="margin-top: 15px;">
      <button class="btn btn-primary" onclick="pingDevice('${device.id}')">Ping Device</button>
      <button class="btn btn-warning" onclick="showBlockIPModal('${device.id}')">Block Device</button>
    </div>
  `;
}

// Network Filter Functions
function applyNetworkFilters() {
  const searchTerm = document.getElementById('deviceSearch').value.toLowerCase();
  const typeFilter = document.getElementById('deviceTypeFilter').value;
  const protocolFilter = document.getElementById('protocolFilter').value;

  filteredNetworkData.nodes = networkData.nodes.filter(node => {
    const matchesSearch = !searchTerm || node.id.toLowerCase().includes(searchTerm);
    const matchesType = typeFilter === 'all' || node.type === typeFilter;
    const matchesProtocol = protocolFilter === 'all' || node.protocols.includes(protocolFilter);
    
    return matchesSearch && matchesType && matchesProtocol;
  });

  const nodeIds = new Set(filteredNetworkData.nodes.map(n => n.id));
  filteredNetworkData.links = networkData.links.filter(link => 
    nodeIds.has(link.source.id || link.source) && nodeIds.has(link.target.id || link.target)
  );

  renderNetworkVisualization();
  updateNetworkStats();
}

function clearNetworkFilters() {
  document.getElementById('deviceSearch').value = '';
  document.getElementById('deviceTypeFilter').value = 'all';
  document.getElementById('protocolFilter').value = 'all';
  
  filteredNetworkData = JSON.parse(JSON.stringify(networkData));
  renderNetworkVisualization();
  updateNetworkStats();
}

function updateNetworkStats() {
  document.getElementById('activeDevicesCount').textContent = filteredNetworkData.nodes.length;
  document.getElementById('activeConnectionsCount').textContent = filteredNetworkData.links.length;
  document.getElementById('suspiciousActivityCount').textContent = 
    filteredNetworkData.nodes.filter(n => n.suspicious).length;
  document.getElementById('blockedIPsCount').textContent = 
    filteredNetworkData.nodes.filter(n => n.blocked).length;
}

// Settings Functions
function showSettingsTab(tabName) {
  // Hide all tab contents
  document.querySelectorAll('.settings-tab-content').forEach(content => {
    content.classList.remove('active');
  });
  
  // Remove active class from all tabs
  document.querySelectorAll('.settings-tab').forEach(tab => {
    tab.classList.remove('active');
  });
  
  // Show selected tab content
  document.getElementById(`${tabName}-settings`).classList.add('active');
  
  // Add active class to clicked tab
  event.target.classList.add('active');
}

function saveAllSettings() {
  const settings = {
    security: {
      portScanThreshold: document.getElementById('portScanThreshold').value,
      synFloodThreshold: document.getElementById('synFloodThreshold').value,
      bruteForceThreshold: document.getElementById('bruteForceThreshold').value,
      autoBlock: document.getElementById('autoBlock').checked,
      autoQuarantine: document.getElementById('autoQuarantine').checked,
      blockDuration: document.getElementById('blockDuration').value
    },
    notifications: {
      email: document.getElementById('emailNotifications').value,
      smtpServer: document.getElementById('smtpServer').value,
      smtpPort: document.getElementById('smtpPort').value,
      emailCritical: document.getElementById('emailCritical').checked,
      emailHigh: document.getElementById('emailHigh').checked,
      browserNotifications: document.getElementById('browserNotifications').checked,
      soundAlerts: document.getElementById('soundAlerts').checked,
      webhookUrl: document.getElementById('webhookUrl').value
    },
    monitoring: {
      cpuThreshold: document.getElementById('cpuThreshold').value,
      memoryThreshold: document.getElementById('memoryThreshold').value,
      diskThreshold: document.getElementById('diskThreshold').value,
      packetRetention: document.getElementById('packetRetention').value,
      alertRetention: document.getElementById('alertRetention').value,
      logRetention: document.getElementById('logRetention').value
    }
  };

  fetch(`${API_BASE}/settings/bulk`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'X-API-Key': API_KEY
    },
    body: JSON.stringify(settings)
  })
    .then(response => response.json())
    .then(data => {
      if (data.success) {
        notyf.success('All settings saved successfully!');
      } else {
        notyf.error('Failed to save settings: ' + data.error);
      }
    })
    .catch(error => {
      console.error('Error saving settings:', error);
      notyf.error('Failed to save settings');
    });
}

    </script>
  </body>
</html>
